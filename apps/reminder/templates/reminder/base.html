{% extends "layout.html" %}
{% block title %}Reminder App{% endblock %}

{% block javascripts %}
<script src="{{ MEDIA_URL }}reminder/js/jquery.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}reminder/js/jquery.dataTables.min.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}reminder/js/jquery-ui-1.8.6.custom.min.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}reminder/js/jquery-ui-timepicker-addon.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}reminder/js/jquery.multiselect.js" type="text/javascript"></script>


<script type="text/javascript" charset="utf-8"> 
var ocTable;
var ogTable;
var contactsSelected =  [];
var groupsSelected = [];
$(document).ready(function() {
    //////////////timepicker logic////////////
    function add_extra_widgets(){
        var hours_input, hours_label;
        hours_input = '<tr><th><label class="hours_selected_label" for="id_hours_select_0" style="display: none;">Hour:</label></th><td> \
                <input type="text" maxlength="5" name="hours" class="hours_selected" id="id_hours_select_0" style="display: none;"value="Click to Choose..." /></td>';

        add_hour_button = '<tr><th /><td><button id="add_hour_button" type="button" style="display: none;">Add Another Hour</button></td></tr>';
//        th = $("label[for='id_weekly_days']").parent();
//        $(hours_input).insertAfter(th.parent())
//        $('.hours_selected').timepicker({});
        $(add_hour_button).insertAfter($("label[for='id_has_end_date']").parent().parent());
        $('#add_hour_button').click(function() {
            add_another_hour();
        });
    }

    function add_another_hour(){
        var count = $(".hours_selected").length;
        var row = '<tr><th><label class="hours_selected_label" for="id_hours_select_'+count+'" style="display: none;">Hour:</label></th><td> \
                <input type="text" maxlength="5" class="hours_selected" name="hours" id="id_hours_select_'+count+'" style="display: visible;"value="Click to Choose..." /></td>'

        tr = $('#add_hour_button').parent().parent();
        $(row).insertBefore(tr);
        $('.hours_selected').show();
        $('.hours_selected_label').show();
        $('#id_hours_select_'+count).timepicker({
                showMinute: false,
                timeFormat: 'hh',
                ampm: false
        });
    }



	$('#id_start_date').datetimepicker();
    $('#id_end_date').datetimepicker();



    add_extra_widgets();



    //////////////////////////////////////////
    ///////////////Form Logic/////////////////


    $('#id_repeat_frequency').change(function () {

        var val = $('#id_repeat_frequency').val();
        if (val == "daily"){
            $("label[for='id_weekly_days']").hide();
            $("#id_weekly_days").parent().children().hide();
            $("label[for='id_yearly_months']").hide();
            $("#id_yearly_months").parent().children().hide();

            $(".hours_selected_label").show();
            $('.hours_selected').show();
            $('#add_hour_button').show();

        }else if(val == "daily"){

        }else if(val == "weekly"){

        }else if(val == "monthly"){

        }else if(val == "yearly"){

        }
        });

    $('#id_has_end_date').parent().parent().css("display",'visible');
    $('#id_has_end_date').change(function() {
       if($('input[name=has_end_date]').is(':checked')){
           $('#id_end_date').parent().parent().hide('fast');
       }else{
           $('#id_end_date').parent().parent().show('fast');
       }
    });

   ///////////////////////
   // choose either the full version


    $("#id_yearly_months").multiselect();
    $("#id_weekly_days").multiselect();


    ////////Contact and Group Table setup
	ogTable = $('#groups_table').dataTable( {
		"bProcessing": true,
		"bServerSide": true,
		"bPaginate"      : true,
		"sPaginationType": "full_numbers",
		"bAutoWidth": false,
		"bJQueryUI": true,
		"sAjaxSource": "groups_table/",
		"fnRowCallback": function( nRow, aData, iDisplayIndex ) {
			if ( jQuery.inArray(aData[0], groupsSelected) != -1 )
			{
				$(nRow).addClass('row_selected');
			}
			return nRow;
		},
		"aoColumns": [
			{ "bVisible": 0 }, /* ID column */
			null,
			null,
		]
	});
	
	
	
	
	ocTable = $('#contacts_table').dataTable( {
		"bProcessing": true,
		"bServerSide": true,
		"bPaginate"      : true,
		"bAutoWidth": false,
		"sPaginationType": "full_numbers",
		"bJQueryUI": true,
		"sAjaxSource": "contacts_table/",
		"fnRowCallback": function( nRow, aData, iDisplayIndex ) {
			if ( jQuery.inArray(aData[0], contactsSelected) != -1 )
			{
				$(nRow).addClass('row_selected');
			}
			return nRow;
		},
		"aoColumns": [
			{ "bVisible": 0 }, /* ID column */
			null,
			null,
			{ "bVisible": 0 },
			null, 
		]
	});
	
	/* Click event handler */
	$('#contacts_table tbody tr').live('click', function () {
		var aData = ocTable.fnGetData( this );
		var iId = aData[0];
		
		if ( jQuery.inArray(iId, contactsSelected) == -1 )
		{
			contactsSelected[contactsSelected.length++] = iId;
		}
		else
		{
			contactsSelected = jQuery.grep(contactsSelected, function(value) {
				return value != iId;
			} );
		}
		
		$(this).toggleClass('row_selected');
	} );
	
		/* Click event handler */
	$('#groups_table tbody tr').live('click', function () {
		var aData = ogTable.fnGetData( this );
		var iId = aData[0];
		
		if ( jQuery.inArray(iId, groupsSelected) == -1 )
		{
			groupsSelected[groupsSelected.length++] = iId;
		}
		else
		{
			groupsSelected = jQuery.grep(groupsSelected, function(value) {
				return value != iId;
			} );
		}
		
		$(this).toggleClass('row_selected');
	} );
	
	$('#contacts_search_box').keyup(function() {
  		 ocTable.fnFilter($('#contacts_search_box').val()); 
	});
	
	$('#groups_search_box').keyup(function() {
  		 ogTable.fnFilter($('#groups_search_box').val()); 
	});
} );
</script>
{% endblock %}

{% block stylesheets %}
{{ block.super }}
		<style type="text/css" title="currentStyle">
			@import "{{ MEDIA_URL }}reminder/css/demo_page.css";
			@import "{{ MEDIA_URL }}reminder/css/demo_table.css";
			@import "{{ MEDIA_URL }}reminder/css/demo_table_jui.css";
            @import "{{ MEDIA_URL }}reminder/css/reminder.css";
		</style> 
        <link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}reminder/css/jquery-ui-1.8.6.custom.css" />
		<link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}reminder/css/reminder.css" />
        <link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}reminder/css/jquery.multiselect.css" />
{% endblock %}

{% block content %}
    <script>




</script>



<div id="scheduler_controls" class="module">
    <h2>Add New Schedule</h2>
    <div id="form_holder">
        <form method="POST" action=".">
            <table class="form_elements">
            {{ form.as_table }}
            </table>
        <input type=submit value="Create Schedule">
        </form>
    </div>
</div>

<div id="contacts_holder" class="module">
<h2>Contacts List</h2>
    <div class="toolbar">
        Search: <input id="contacts_search_box" type="text" />
    </div>
</div>

<div id="groups_holder" class="module">
<h2>Groups List</h2>
    <div class="toolbar">
        Search: <input id="groups_search_box" type="text" />
    </div>
</div>

<table cellpadding="0" cellspacing="0" border="0" class="display" id="contacts_table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Phone Number</th>
            <th>Language</th>
            <th>Groups</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td colspan="5" class="dataTables_empty">Loading data from server</td>
        </tr>
    </tbody>
    <tfoot>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Phone Number</th>
            <th>Language</th>
            <th>Groups</th>
        </tr>
    </tfoot>
</table>


<!-- <div class="spacer" id="between_tables"></div> -->

<table cellpadding="0" cellspacing="0" border="0" class="display" id="groups_table">
    <thead>
        <tr>
            <th>ID</th>
            <th width="10%">Name</th>
            <th width="15%">Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td colspan="5" class="dataTables_empty">Loading data from server</td>
        </tr>
    </tbody>
    <tfoot>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Description</th>
        </tr>
    </tfoot>
</table>


				
<div class="spacer"></div> 
			


{% endblock %}














