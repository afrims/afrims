{% extends "afrims/layout-split-2.html" %}

{% load report_tags %}

{% block content %}
<h1>TrialConnect Performance Report</h1>
<div class="module">
    <table id="overview-table">
        <thead>
            <tr>
                <th>Overview</th>                
                <th>To Date</th>
                <th>This Month</th>
            </tr>
        </thead>
        <tr class="odd">
            <td>Messages - Outgoing</td>
            <td>{{ to_date.messages.outgoing|default:0 }}</td>
            <td>{{ this_month.messages.outgoing|default:0 }}</td>
        </tr>
        <tr class="even">
            <td>Messages - Incoming</td>
            <td>{{ to_date.messages.incoming|default:0 }}</td>
            <td>{{ this_month.messages.incoming|default:0 }}</td>
        </tr>
        <tr class="even">
            <td>% of Appointments Confirmed</td>
            <td>{{ to_date.appointments.percent|default:0 }} %</td>
            <td>{{ this_month.appointments.percent|default:0 }} %</td>
        </tr>
        <tr class="even">
            <td>% of Reminders Confirmed</td>
            <td>{{ to_date.reminders.percent|default:0 }} %</td>
            <td>{{ this_month.reminders.percent|default:0 }} %</td>
        </tr>
    </table>
</div>
<div class="module">
    <table id="system-usage">
        <thead>
            <tr>
                <th colspan="2">Overall System Usage, This Month</th>                
                <th>Total </th>
                <th>Patients</th>
                <th>Internal Staff</th>
            </tr>
        </thead>
        <tr>
            <td colspan="5">Users</td>
        <tr>
        <tr>
            <td colspan="2">Total</td>
            <td>{{ to_date.users.total }}</td>
            <td>{{ to_date.users.patients }}</td>
            <td>{{ to_date.users.staff }}</td>
        </tr>
        <tr>
            <td rowspan="2">Active Users</td>
            <td>Number</td>
            <td>{{ this_month.users.total }}</td>
            <td>{{ this_month.users.patients }}</td>
            <td>{{ this_month.users.staff }}</td>
        </tr>
        <tr>
            <td>% of Total Users</td>
            <td>{{ this_month.users.total|percent:to_date.users.total }}</td>
            <td>{{ this_month.users.patients|percent:to_date.users.patients }}</td>
            <td>{{ this_month.users.staff|percent:to_date.users.staff }}</td>
        </tr>
        <tr>
            <td colspan="5">Messages</td>
        <tr>
        <tr>
            <td rowspan="2">Messages - Outgoing</td>
            <td>Number</td>
            <td>{{ this_month.messages.outgoing|default:0 }}</td>
            <td>{{ this_month.patient_messages.outgoing|default:0 }}</td>
            <td>{{ this_month.staff_messages.outgoing|default:0 }}</td>
        </tr>
        <tr>
            <td>Avg. per User</td>
            <td>{{ this_month.messages.outgoing|divide:to_date.users.total }}</td>
            <td>{{ this_month.patient_messages.outgoing|divide:to_date.users.patients }}</td>
            <td>{{ this_month.staff_messages.outgoing|divide:to_date.users.staff }}</td>
        </tr>
        <tr>
            <td rowspan="2">Messages - Incoming</td>
            <td>Number</td>
            <td>{{ this_month.messages.incoming|default:0 }}</td>
            <td>{{ this_month.patient_patient.incoming|default:0 }}</td>
            <td>{{ this_month.staff_messages.incoming|default:0 }}</td>
        </tr>
        <tr>
            <td>Avg. per User</td>
            <td>{{ this_month.messages.incoming|divide:to_date.users.total }}</td>
            <td>{{ this_month.patient_messages.incoming|divide:to_date.users.patients }}</td>
            <td>{{ this_month.staff_messages.incoming|divide:to_date.users.staff }}</td>
        </tr>
    </table>
</div>
<div class="module">
    <table id="reminders-table">
        <thead>
            <tr>
                <th>Appointment Reminders</th>
                <th>Last Month</th>
                <th>This Month</th>
            </tr>
        </thead>
        <tr>
            <td>Total Reminders Sent</td>
            <td>{{ last_month.reminders.total|default:0 }}</td>
            <td>{{ this_month.reminders.total|default:0 }}</td>
        </tr>
        <tr>
            <td>% of Appointments Confirmed</td>
            <td>{{ last_month.appointments.percent|default:0 }}</td>
            <td>{{ this_month.appointments.percent|default:0 }}</td>
        </tr>
        <tr>
            <td>% of Reminders Confirmed</td>
            <td>{{ last_month.reminders.percent|default:0 }}</td>
            <td>{{ this_month.reminders.percent|default:0 }}</td>
        </tr>
        <tr>
            <td>Avg. Number Reminders per Appointment</td>
            <td>{{ last_month.reminders.total|divide:last_month.appointments.total }}</td>
            <td>{{ this_month.reminders.total|divide:this_month.appointments.total }}</td>
        </tr>
        <tr>
            <td>Avg. Number of Confirmations per Appointment</td>
            <td>{{ last_month.reminders.confirmed|divide:last_month.appointments.total }}</td>
            <td>{{ this_month.reminders.confirmed|divide:this_month.appointments.total }}</td>
        </tr>
    </table>
</div>
<div class="module">
    <table id="broadcasts-table">
        <thead>
            <tr>
                <th colspan="2">Broadcast Messages</th>
                <th>Last Month</th>
                <th>This Month</th>
            </tr>
        </thead>
        <tr>
            <td colspan="2">Total Sent</td>
            <td>{{ last_month.broadcasts.total|default:0 }}</td>
            <td>{{ this_month.broadcasts.total|default:0 }}</td>
        </tr>
        <tr>
            <td rowspan="2">Patients</td>
            <td>Received</td>
            <td>{{ last_month.broadcasts.patients|default:0 }}</td>
            <td>{{ this_month.broadcasts.patients|default:0 }}</td>
        </tr>
        <tr>
            <td>Avg. per Patient</td>
            <td>{{ last_month.broadcasts.patients|divide:last_month.users.patients }}</td>
            <td>{{ this_month.broadcasts.patients|default:this_month.users.patients }}</td>
        </tr>
        <tr>
            <td rowspan="2">Internal Staff</td>
            <td>Received</td>
            <td>{{ last_month.broadcasts.staff|default:0 }}</td>
            <td>{{ this_month.broadcasts.staff|default:0 }}</td>
        </tr>
        <tr>
            <td>Avg. per Internal Staff</td>
            <td>{{ last_month.broadcasts.staff|divide:last_month.users.staff }}</td>
            <td>{{ this_month.broadcasts.staff|divide:this_month.users.staff }}</td>
        </tr>
    </table>
</div>
<div class="module">
    <table id="other-table">
        <thead>
            <tr>
                <th>Other Messages, by Activity</th>
                <th>Last Month</th>
                <th>This Month</th>
            </tr>
        </thead>
        <tr>
            <td>Callback Requests</td>
            <td>{{ last_month.broadcasts.callbacks|default:0 }}</td>
            <td>{{ this_month.broadcasts.callbacks|default:0 }}</td>
        </tr>
        <tr>
            <td>Cold Chain</td>
            <td>{{ last_month.broadcasts.coldchain|default:0 }}</td>
            <td>{{ this_month.broadcasts.coldchain|default:0 }}</td>
        </tr>
    </table>
</div>
{% endblock %}
